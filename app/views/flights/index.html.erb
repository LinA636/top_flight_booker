<h1>Search for a flight</h1>

<%= form_with(url: request.fullpath, method: :get) do |form| %>
  <!-- dropdown list for departure airports -->
  <div class="field">
    <%= form.label :departure_airport_id %>
    <%= form.collection_select :departure_airport_id, Airport.all, :id, :airport_code, { prompt: 'Select Departure Airport' } %>
  </div>

  <div class="field">
    <%= form.label :arrival_airport_id %>
    <%= form.collection_select :arrival_airport_id, Airport.all, :id, :airport_code, { prompt: 'Select Arrival Airport' } %>
  </div>

  <div class="field">
    <%= form.label :num_passangers %>
    <%= form.collection_select :num_passangers, (1..4), :to_i, :to_s, { prompt: 'Select Number of Passengers' } %>
  </div>

  <div class="field">
    <%= form.label :start_datetime, 'Select a day:' %>
    <%= form.select :start_datetime, 
      options_for_select(@available_dates.map{ |date| [date.strftime('%B %d, %Y'), date] }, @start_datetime) %>
  </div>

  <div class="actions">
    <%= form.submit "Search", class: "btn btn-primary" %>
  </div>
<% end %>

<h2>Available Flights</h2>

<%= form_with(url: new_booking_path, method: :get) do |form|%>
  <table class="available_flights_table">
    <thead>
      <tr>
        <th>Departure Airport</th>
        <th>Arrival Airport</th>
        <th>Start Day</th>
        <th>Flight Duration</th>
      </tr>
    </thead>

    <tbody>
      <% @flights.each do |flight| %>
        <tr>
          <td><%= flight.departure_airport.airport_code%></td>
          <td><%= flight.arrival_airport.airport_code %></td>
          <td><%= flight.start_datetime %></td>
          <td><%= flight.flight_duration %></td>
          <td>
            <div class="field">
              <%= form.radio_button :selected_flight, flight%>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= form.hidden_field :num_passengers, value: @num_passengers %>
  
  <div class="actions">
    <%= form.submit "Continue to Booking", class: "btn btn-primary" %>
  </div>
<% end %>